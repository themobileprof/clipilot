<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - CLIPilot Registry</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <nav>
        <div class="container">
            <h1><a href="/">CLIPilot Registry</a></h1>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/modules">Browse Modules</a></li>
                {{if .LoggedIn}}
                    <li><a href="/my-modules">My Modules</a></li>
                    <li><a href="/upload">Upload</a></li>
                    <li><a href="/logout">Logout</a></li>
                {{else}}
                    <li><a href="/login">Login</a></li>
                {{end}}
            </ul>
        </div>
    </nav>
    <main class="container">
        <section>
    <h2>Upload Module</h2>
    <p>Share your CLI automation module with the community.</p>
    
    <div class="upload-form">
        <form id="uploadForm" enctype="multipart/form-data">
            <div class="form-group">
                <label for="module">YAML Module File</label>
                <input type="file" id="module" name="module" accept=".yaml,.yml" required>
                <small>Maximum file size: 10MB</small>
            </div>
            
            <button type="submit" class="btn btn-primary">Upload Module</button>
        </form>
        
        <div id="result" class="result"></div>
    </div>
    
    <div class="spec">
        <h3>ðŸ“‹ Module Specification</h3>
        <p>Your YAML file must follow this structure:</p>
        
        <pre><code>name: your_module_name          # Required: lowercase with underscores only
version: "1.0.0"                # Required: semantic versioning (X.Y.Z)
description: Brief description  # Required: what does this module do? (max 500 chars)
tags:                           # Required: at least one tag for discovery
  - keyword1
  - keyword2

metadata:                       # Optional module info
  author: Your Name
  license: MIT

flows:
  main:                         # At least one flow required
    start: step1                # Required: first step name
    steps:
      step1:                    # Step names as map keys
        type: instruction       # Required: instruction, action, branch, terminal
        message: "Message"      # Required for most steps
        command: "bash cmd"     # Required for action steps
        next: step2             # Optional: next step name</code></pre>
        
        <h4>Step Types</h4>
        <ul>
            <li><strong>instruction</strong>: Display message to user, optionally execute command</li>
            <li><strong>action</strong>: Execute a bash command (requires <code>command</code> field)</li>
            <li><strong>branch</strong>: Conditional flow control (requires <code>based_on</code> field with step output)</li>
            <li><strong>terminal</strong>: End the flow with a message (success or failure state)</li>
        </ul>
        
        <h4>Validation Rules</h4>
        <ul>
            <li>âœ“ Name: lowercase, alphanumeric, underscores only (no dashes)</li>
            <li>âœ“ Version: semantic versioning format (e.g., 1.0.0)</li>
            <li>âœ“ Description: required, max 500 characters</li>
            <li>âœ“ Tags: at least 1 tag, max 20 tags, 50 chars each</li>
            <li>âœ“ Flows: at least one flow with <code>start</code> field</li>
            <li>âœ“ Steps: defined as map (key: step_name), not array</li>
            <li>âœ“ Action steps must have <code>command</code> field</li>
            <li>âœ“ Branch steps must have <code>based_on</code> field</li>
        </ul>
        
        <h4>Example: Simple Git Setup</h4>
        <pre><code>name: git_setup
version: "1.0.0"
description: Configure Git with user name and email
tags:
  - git
  - setup
  - configuration

metadata:
  author: CLIPilot Team
  license: MIT

flows:
  main:
    start: check_git
    steps:
      check_git:
        type: instruction
        message: "Checking if Git is installed..."
        command: "which git"
        next: set_name
      
      set_name:
        type: action
        message: "Setting Git user name..."
        command: "git config --global user.name 'Your Name'"
        next: set_email
      
      set_email:
        type: action
        message: "Setting Git email..."
        command: "git config --global user.email 'you@example.com'"
        next: done
      
      done:
        type: terminal
        message: "âœ“ Git configured successfully!"</code></pre>
    </div>
    
        <div class="prompt-box">
            <p><strong>Copy this prompt:</strong></p>
            <pre><code>Create a CLIPilot module YAML file for [DESCRIBE YOUR TASK].

Required structure:
- Top level: name (lowercase_with_underscores), version ("X.Y.Z"), description (max 500 chars)
- tags: array with at least one tag for discovery
- metadata: optional author and license
- flows: at least one flow with "start" field and "steps" map
- Each flow must have "start" pointing to first step name
- Steps are defined as a map with step names as keys (not an array)

Step types:
- instruction: message only, no command execution
- action: requires "command" field, executes bash commands
- branch: conditional flow based on "based_on" field
- terminal: end state with success/failure message

Each step should have:
- type: (required) one of the above types
- message: (optional but recommended) shown to user
- command: (required for action steps) bash command to execute
- next: (optional) name of next step to execute

Requirements:
1. Step names must be valid YAML map keys
2. Use "next" field to chain steps together
3. Terminal steps don't need "next" field
4. Choose descriptive tags for intent matching

Output ONLY valid YAML, no explanations or markdown.</code></pre>
4. Use terminal steps for success/failure endings
5. Choose relevant keywords for intent detection

Output ONLY the YAML code, no explanations.</code></pre>
            
            <button onclick="copyPrompt()" class="btn btn-secondary">Copy Prompt</button>
        </div>
        
        <p><strong>Example usage:</strong></p>
        <blockquote>
            "Create a CLIPilot module YAML file for setting up a Python virtual environment with pip and installing common data science packages."
        </blockquote>
    </div>
</section>

<script>
document.getElementById('uploadForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const result = document.getElementById('result');
    
    result.className = 'result loading';
    result.textContent = 'Uploading...';
    
    try {
        const response = await fetch('/api/upload', {
            method: 'POST',
            body: formData
        });
        
        const data = await response.json();
        
        if (response.ok) {
            result.className = 'result success';
            result.textContent = 'âœ“ ' + data.message;
            e.target.reset();
        } else {
            result.className = 'result error';
            result.textContent = 'âœ— ' + (data.error || 'Upload failed');
        }
    } catch (err) {
        result.className = 'result error';
        result.textContent = 'âœ— Network error: ' + err.message;
    }
});

function copyPrompt() {
    const prompt = document.querySelector('.prompt-box pre code').textContent;
    navigator.clipboard.writeText(prompt).then(() => {
        alert('Prompt copied to clipboard!');
    });
}
</script>
    </main>
    <footer>
        <div class="container">
            <p>&copy; 2024 CLIPilot Registry. Open source CLI automation platform.</p>
        </div>
    </footer>
</body>
</html>
